@model WebSiteBanHang.Models.Commom.CheckoutViewModel

@{
    Layout = null;
    var session = (WebSiteBanHang.Models.User)Session[WebSiteBanHang.Commons.sessionLogin.USER_SESSION];
    decimal totalPrice = 0;
}
<html class="floating-labels">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>Thanh toán đơn hàng</title>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/Assets/Css/checkout.vendor.min.css">
    <link rel="stylesheet" href="~/Assets/Css/checkout.min.css">
    <script src="//bizweb.dktcdn.net/assets/themes_support/libphonenumber-v3.2.30.min.js?1684115584822"></script>
    <script src="~/Assets/Js/checkout.vendor.min.js"></script>
    <script src="~/Assets/Js/checkout.min.js"></script>

</head>
<body data-no-turbolink="">
    <header class="banner">
        <div class="wrap">
            <div class="logo logo--left">
                <h1 class="shop__name">
                    <a href="/">Template Honey Bee</a>
                </h1>
            </div>
        </div>
    </header>
    <aside>
        <button class="order-summary-toggle" data-toggle="#order-summary" data-toggle-class="order-summary--is-collapsed">
            <span class="wrap">
                <span class="order-summary-toggle__inner">
                    <span class="order-summary-toggle__text expandable">
                        Đơn hàng ()
                    </span>
                    <span class="order-summary-toggle__total-recap" data-bind="getTextTotalPrice()">640.000₫</span>
                </span>
            </span>
        </button>
    </aside>
    <div data-tg-refresh="checkout" id="checkout" class="content" data-select2-id="select2-data-checkout">
        @using (Html.BeginForm("CheckOut", "GioHang", FormMethod.Post, new { @enctype = "multipart/form-data" }))
        {
            <input type="hidden" name="_method" value="patch">
            <div class="wrap" data-select2-id="select2-data-219-v4vd">
                <main class="main">
                    <header class="main__header">
                        <div class="logo logo--left">
                            <h1 class="shop__name">
                                <a href="TrangChu/index">Template Honey Bee</a>
                            </h1>
                        </div>
                    </header>
                    <div class="main__content" data-select2-id="select2-data-218-7h4f">
                        <article class="animate-floating-labels row">
                            <div class="col col--two">
                                <section class="section" data-select2-id="select2-data-217-7kgv">
                                    <div class="section__header">
                                        <div class="layout-flex">
                                            <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                                <i class="fa fa-id-card-o fa-lg section__title--icon hide-on-desktop"></i>
                                                Thông tin nhận hàng
                                            </h2>

                                            @if (session != null)
                                            {
                                                <a href="/TaiKhoan/logout?returnUrl=@Url.Action("CheckOut", "GioHang")">
                                                    <i class="fa-solid fa-right-from-bracket"></i>
                                                    <span>Đăng Xuất</span>
                                                </a>
                                            }
                                            else
                                            {
                                                <a href="/TaiKhoan/login?returnUrl=@Url.Action("CheckOut", "GioHang")">
                                                    <i class="fa-regular fa-circle-user"></i>
                                                    <span>Đăng nhập</span>
                                                </a>
                                            }

                                        </div>
                                    </div>
                                    <div class="section__content" data-select2-id="select2-data-216-i3r4">
                                        <div class="fieldset">
                                            @if (session != null)
                                            {
                                                if (Model.Addresses.Count > 0)
                                                {

                                                    <div class="field field--show-floating-label">
                                                        <div class="field__input-wrapper">
                                                            <label for="customer-address" class="field__label">Sổ địa chỉ</label>
                                                            <select size="1" class="field__input field__input--select" id="customer-address" data-bind="customerAddress">
                                                                <option value="">Địa chỉ khác...</option>
                                                                @foreach (var item in Model.Addresses)
                                                                {
                                                                    <option data-id="@item.Id" data-name="@item.hoten" data-address="@item.diachi" data-phone="@item.sodt" data-province="@item.tinhthanh" data-district="@item.quanhuyen" data-ward="@item.phuongxa">
                                                                        @{
                                                                            var parts = new List<string>();
                                                                            if (!string.IsNullOrEmpty(item.hoten))
                                                                            {
                                                                                parts.Add(item.hoten);
                                                                            }
                                                                            if (!string.IsNullOrEmpty(item.diachi))
                                                                            {
                                                                                parts.Add(item.diachi);
                                                                            }
                                                                            if (!string.IsNullOrEmpty(item.phuongxa))
                                                                            {
                                                                                parts.Add(item.phuongxa);
                                                                            }
                                                                            if (!string.IsNullOrEmpty(item.quanhuyen))
                                                                            {
                                                                                parts.Add(item.quanhuyen);
                                                                            }
                                                                            if (!string.IsNullOrEmpty(item.tinhthanh))
                                                                            {
                                                                                parts.Add(item.tinhthanh);
                                                                            }
                                                                        }
                                                                        @string.Join(", ", parts)
                                                                    </option>
                                                                }
                                                            </select>
                                                            <div class="field__caret">
                                                                <i class="fa fa-caret-down"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }

                                                <div class="field field--show-floating-label field--disabled">
                                                    <input name="email" type="hidden" value="">
                                                    <div class="field__input-wrapper">
                                                        <label for="email" class="field__label">
                                                            Email
                                                        </label>
                                                        <input id="NewAddress.email" type="text" class="field__input" value="@session.email" name="NewAddress.email" readonly>
                                                    </div>
                                                </div>
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js"></script>
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

                                                <script>
                                                    document.addEventListener("DOMContentLoaded", function () {
                                                        var selectElement = document.getElementById("customer-address");

                                                        selectElement.addEventListener("change", function () {
                                                            var selectedOption = this.options[this.selectedIndex];
                                                            if (selectedOption.value !== "") {
                                                                var name = selectedOption.getAttribute("data-name");
                                                                var address = selectedOption.getAttribute("data-address");
                                                                var phone = selectedOption.getAttribute("data-phone");
                                                                var province = selectedOption.getAttribute("data-province");
                                                                var district = selectedOption.getAttribute("data-district");
                                                                var ward = selectedOption.getAttribute("data-ward");
                                                                document.querySelector("input[name='NewAddress.hoten']").value = name;
                                                                document.querySelector("input[name='NewAddress.sodt']").value = phone;
                                                                document.querySelector("input[name='NewAddress.diachi']").value = address;
                                                                var inputs = document.querySelectorAll("input");
                                                                inputs.forEach(function (input) {
                                                                    if (input.value !== '') {
                                                                        input.parentElement.parentElement.classList.add('field--show-floating-label');
                                                                    } else {
                                                                        input.parentElement.parentElement.classList.remove('field--show-floating-label');
                                                                    }
                                                                });
                                                                initializeDropdowns("billingProvince", "billingDistrict", "billingWard", province, district, ward);
                                                            } else {
                                                                document.querySelector("input[name='NewAddress.hoten']").value = "";
                                                                document.querySelector("input[name='NewAddress.sodt']").value = "";
                                                                document.querySelector("input[name='NewAddress.diachi']").value = "";
                                                            }
                                                        });
                                                    });

                                                </script>

                                            }
                                            else
                                            {
                                                <div class="field">
                                                    <div class="field__input-wrapper">
                                                        <label for="email" class="field__label">
                                                            Email
                                                        </label>
                                                        <input id="NewAddress.email" type="text" class="field__input" value="" name="NewAddress.email">
                                                    </div>
                                                </div>
                                            }
                                            <div class="field">
                                                <div class="field__input-wrapper">
                                                    <label for="lastName" class="field__label">Họ và tên</label>
                                                    <input id="NewAddress.hoten" type="text" class="field__input" value="" name="NewAddress.hoten" , required>
                                                </div>
                                            </div>

                                            <div class="field">
                                                <div class="field__input-wrapper field__input-wrapper--connected">
                                                    <label for="phone" class="field__label">
                                                        Số điện thoại (tùy chọn)
                                                    </label>
                                                    <input id="NewAddress.sodt" type="text" class="field__input" value="" name="NewAddress.sodt" , required>
                                                </div>
                                            </div>

                                            <div class="field">
                                                <div class="field__input-wrapper">
                                                    <label for="billingAddress" class="field__label">
                                                        Địa chỉ (tùy chọn)
                                                    </label>
                                                    <input id="NewAddress.diachi" type="text" class="field__input" value="" name="NewAddress.diachi" , required>
                                                </div>
                                            </div>
                                            <div class="field field--show-floating-label ">
                                                <div class="field__input-wrapper field__input-wrapper--select2" data-select2-id="select2-data-215-9w0o">
                                                    <label for="billingProvince" class="field__label">Tỉnh thành</label>
                                                    <select name="NewAddress.tinhthanh" id="billingProvince" class="field__input field__input--select select2-hidden-accessible" data-bind="billing.province" data-address-type="province" data-select2-id="select2-data-billingProvince" tabindex="-1" aria-hidden="true">
                                                        <option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="field field--show-floating-label ">
                                                <div class="field__input-wrapper field__input-wrapper--select2">
                                                    <label for="billingDistrict" class="field__label">
                                                        Quận huyện (tùy chọn)
                                                    </label>
                                                    <select name="NewAddress.quanhuyen" id="billingDistrict" class="field__input field__input--select select2-hidden-accessible" data-bind="billing.district" data-address-type="district" data-select2-id="select2-data-billingDistrict" tabindex="-1" aria-hidden="true" disabled>
                                                        <option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="field field--show-floating-label ">
                                                <div class="field__input-wrapper field__input-wrapper--select2">
                                                    <label for="billingWard" class="field__label">
                                                        Phường xã (tùy chọn)
                                                    </label>
                                                    <select name="NewAddress.phuongxa" id="billingWard" size="1" class="field__input field__input--select select2-hidden-accessible" value="" data-bind="billing.ward" data-address-type="ward" data-select2-id="select2-data-billingWard" tabindex="-1" aria-hidden="true" disabled>
                                                        <option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <div class="fieldset">
                                    <h3 class="visually-hidden">Ghi chú</h3>
                                    <div class="field " data-bind-class="{'field--show-floating-label': note}">
                                        <div class="field__input-wrapper">
                                            <label for="note" class="field__label">
                                                Ghi chú (tùy chọn)
                                            </label>
                                            <textarea name="Order.ghichu" id="note" class="field__input" data-bind="note"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col col--two">
                                <section class="section" data-define="{shippingMethod: '693661_0,40.000 VND'}">
                                    <div class="section__header">
                                        <div class="layout-flex">
                                            <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                                <i class="fa fa-truck fa-lg section__title--icon hide-on-desktop"></i>
                                                Vận chuyển
                                            </h2>
                                        </div>
                                    </div>
                                    <div class="section__content" data-tg-refresh="refreshShipping" id="shippingMethodList" data-define="{isAddressSelecting: false, shippingMethods: []}">
                                        <div class="content-box">
                                            <div class="content-box__row">
                                                <div class="radio-wrapper">
                                                    <div class="radio__input">
                                                        <input type="radio" class="input-radio" name="shippingMethod">
                                                    </div>
                                                    <label for="shippingMethod-693661_0" class="radio__label">
                                                        <span class="radio__label__primary">
                                                            <span>Giao hàng tận nơi</span>
                                                        </span>
                                                        <span class="radio__label__accessory">
                                                            <span class="content-box__emphasis price">
                                                                40.000₫
                                                            </span>
                                                        </span>
                                                    </label>
                                                </div>
                                               
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <section class="section">
                                    <div class="section__header">
                                        <div class="layout-flex">
                                            <h2 class="section__title layout-flex__item layout-flex__item--stretch">
                                                <i class="fa fa-credit-card fa-lg section__title--icon hide-on-desktop"></i>
                                                Thanh toán
                                            </h2>
                                        </div>
                                    </div>
                                    <div class="section__content">
                                        <div class="content-box" data-define="{paymentMethod: undefined}">
                                            <div class="content-box__row">
                                                <div class="radio-wrapper">
                                                    <div class="radio__input">
                                                        @Html.RadioButtonFor(model => model.Order.phuongthucthanhtoan, "1", new { @class = "input-radio", @id = "paymentMethod-1", @type = "radio", @name = "Order.thanhtoan", @value = "1" })
                                                    </div>
                                                    <label for="paymentMethod-1" class="radio__label">
                                                        <span class="radio__label__primary">Thanh toán khi giao hàng (COD)</span>
                                                        <span class="radio__label__accessory">
                                                            <span class="radio__label__icon">
                                                                <i class="fa-solid fa-money-bill"></i>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="radio-wrapper">
                                                    <div class="radio__input">
                                                        @Html.RadioButtonFor(model => model.Order.phuongthucthanhtoan, "2", new { @class = "input-radio", @id = "paymentMethod-1", @type = "radio", @name = "Order.thanhtoan", @value = "2" })

                                                    </div>
                                                    <label for="paymentMethod-2" class="radio__label">
                                                        <span class="radio__label__primary">Thanh toán Chuyển khoản (Online)</span>
                                                        <span class="radio__label__accessory">
                                                            <span class="radio__label__icon">
                                                                <i class="fa-solid fa-money-bill-transfer"></i>
                                                            </span>
                                                        </span>
                                                    </label>
                                                </div>
                                                <div class="content-box__row__desc hide" id="paymentMethodDesc1">
                                                    <p>Bạn chỉ phải thanh toán khi nhận được hàng</p>
                                                </div>
                                                <div class="content-box__row__desc hide" id="paymentMethodDesc2">
                                                    <p>Bạn thanh toán chuyển khoản</p>
                                                </div>
                                            </div>
                                            <script>
                                                const paymentMethods = document.querySelectorAll('input[name="Order.phuongthucthanhtoan"]');
                                                const paymentMethodDesc1 = document.getElementById('paymentMethodDesc1');
                                                const paymentMethodDesc2 = document.getElementById('paymentMethodDesc2');

                                                paymentMethods.forEach(function (input) {
                                                    input.addEventListener('change', function () {
                                                        if (input.value === '1') {
                                                            paymentMethodDesc1.classList.remove('hide');
                                                            paymentMethodDesc2.classList.add('hide');
                                                        } else if (input.value === '2') {
                                                            paymentMethodDesc1.classList.add('hide');
                                                            paymentMethodDesc2.classList.remove('hide');
                                                        }
                                                    });
                                                });
                                            </script>

                                        </div>
                                    </div>

                                </section>
                            </div>
                        </article>
                        <div class="field__input-btn-wrapper field__input-btn-wrapper--vertical hide-on-desktop">
                            <button type="submit" class="btn btn-checkout spinner" data-bind-class="{'spinner--active': isSubmitingCheckout}" data-bind-disabled="isSubmitingCheckout || isLoadingReductionCode">
                                <span class="spinner-label">ĐẶT HÀNG</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                                    <use href="#spinner"></use>
                                </svg>
                            </button>
                            <a href="/cart" class="previous-link">
                                <i class="previous-link__arrow">❮</i>
                                <span class="previous-link__content">Quay về giỏ hàng</span>
                            </a>
                        </div>
                        <div id="common-alert" data-tg-refresh="refreshError">
                            <div class="alert alert--danger hide-on-desktop hide" data-bind-show="!isSubmitingCheckout &amp;&amp; isSubmitingCheckoutError" data-bind="submitingCheckoutErrorMessage">Có lỗi xảy ra khi xử lý. Vui lòng thử lại</div>
                        </div>
                    </div>

                </main>
                <aside class="sidebar">
                    <div class="sidebar__header">
                        <h2 class="sidebar__title">
                            Đơn hàng (@Model.CartItems.Count sản phẩm)
                        </h2>
                    </div>
                    <div class="sidebar__content">
                        <div id="order-summary" class="order-summary order-summary--is-collapsed">
                            <div class="order-summary__sections">
                                <div class="order-summary__section order-summary__section--product-list order-summary__section--is-scrollable order-summary--collapse-element">
                                    <table class="product-table">
                                        <caption class="visually-hidden">Chi tiết đơn hàng</caption>
                                        <thead class="product-table__header">
                                            <tr>
                                                <th>
                                                    <span class="visually-hidden">Ảnh sản phẩm</span>
                                                </th>
                                                <th>
                                                    <span class="visually-hidden">Mô tả</span>
                                                </th>
                                                <th>
                                                    <span class="visually-hidden">Sổ lượng</span>
                                                </th>
                                                <th>
                                                    <span class="visually-hidden">Đơn giá</span>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.CartItems)
                                            {
                                                <tr class="product">
                                                    <td class="product__image">
                                                        <div class="product-thumbnail">
                                                            <div class="product-thumbnail__wrapper" data-tg-static="">
                                                                <img src="@Url.Content("~/Assets/image/large/" + Path.GetFileName(item.Product.hinhanh))" alt="" class="product-thumbnail__image">
                                                            </div>
                                                            <span class="product-thumbnail__quantity">@item.soluong</span>
                                                        </div>
                                                    </td>
                                                    <th class="product__description">
                                                        <span class="product__description__name">
                                                            @item.Product.ten
                                                        </span>
                                                    </th>
                                                    <td class="product__quantity visually-hidden"><em>Số lượng:</em> @item.soluong</td>
                                                    <td class="product__price">
                                                        @string.Format("{0:N0}", item.Product.giatien * item.soluong)₫
                                                    </td>
                                                </tr>
                                                totalPrice += item.Product.giatien;
                                                totalPrice *= (decimal)item.soluong;
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="order-summary__section order-summary__section--discount-code" data-tg-refresh="refreshDiscount" id="discountCode">
                                    <h3 class="visually-hidden">Mã khuyến mại</h3>
                                    <div class="edit_checkout animate-floating-labels">
                                        <div class="fieldset">
                                            <div class="field ">
                                                <div class="field__input-btn-wrapper">
                                                    <div class="field__input-wrapper">
                                                        <label for="reductionCode" class="field__label">Nhập mã giảm giá</label>
                                                        <input name="reductionCode" id="reductionCode" type="text" class="field__input" autocomplete="off" data-bind-disabled="isLoadingReductionCode" data-bind-event-keypress="handleReductionCodeKeyPress(event)" data-define="{reductionCode: null}" data-bind="reductionCode">
                                                    </div>
                                                    <button class="field__input-btn btn spinner btn--disabled" type="button" data-bind-disabled="isLoadingReductionCode || !reductionCode" data-bind-class="{'spinner--active': isLoadingReductionCode, 'btn--disabled': !reductionCode}" data-bind-event-click="applyReductionCode()" disabled="">
                                                        <span class="spinner-label">Áp dụng</span>
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="spinner-loader">
                                                            <use href="#spinner"></use>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <p class="field__message field__message--error field__message--error-always-show hide" data-bind-show="!isLoadingReductionCode &amp;&amp; isLoadingReductionCodeError" data-bind="loadingReductionCodeErrorMessage">Có lỗi xảy ra khi áp dụng khuyến mãi. Vui lòng thử lại</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="order-summary__section order-summary__section--total-lines order-summary--collapse-element" data-define="{subTotalPriceText: '600.000₫'}" data-tg-refresh="refreshOrderTotalPrice" id="orderSummary">
                                    <table class="total-line-table">
                                        <caption class="visually-hidden">Tổng giá trị</caption>
                                        <thead>
                                            <tr>
                                                <td><span class="visually-hidden">Mô tả</span></td>
                                                <td><span class="visually-hidden">Giá tiền</span></td>
                                            </tr>
                                        </thead>
                                        <tbody class="total-line-table__tbody">
                                            <tr class="total-line total-line--subtotal">
                                                <th class="total-line__name">
                                                    Tạm tính
                                                </th>
                                                <td class="total-line__price">@string.Format("{0:N0}", totalPrice)₫</td>
                                            </tr>
                                            <tr class="total-line total-line--shipping-fee">
                                                <th class="total-line__name">
                                                    Phí vận chuyển
                                                </th>
                                                <td class="total-line__price" data-bind="">-</td>

                                            </tr>
                                        </tbody>

                                        <tfoot class="total-line-table__footer">
                                            <tr class="total-line payment-due">
                                                <th class="total-line__name">
                                                    <span class="payment-due__label-total">
                                                        Tổng cộng
                                                    </span>
                                                </th>
                                                <td class="total-line__price">
                                                    <span class="payment-due__price">@string.Format("{0:N0}", totalPrice)₫</span>
                                                </td>
                                            </tr>
                                        </tfoot>
                                        <script>
                                            document.querySelector("input[name='shippingMethod']").addEventListener("change", function () {
                                                if (this.checked) {
                                                    var shippingFee = document.querySelector(".total-line--shipping-fee .total-line__price");
                                                    var price = 40000;
                                                    var formattedPrice = price.toLocaleString('vi-VN', { minimumFractionDigits: 0 });
                                                    shippingFee.textContent = formattedPrice + "₫";
                                                    var totalPriceText = document.querySelector(".payment-due .total-line__price .payment-due__price");
                                                    var totalPrice = @totalPrice + price;
                                                    var formattedtotalPrice = totalPrice.toLocaleString('vi-VN', { minimumFractionDigits: 0 });
                                                    totalPriceText.textContent = formattedtotalPrice + "₫"; 
                                                }
                                            });
                                        </script>
                                    </table>
                                </div>
                                <div class="order-summary__nav field__input-btn-wrapper hide-on-mobile layout-flex--row-reverse">
                                    <button type="submit" class="btn btn-checkout spinner">
                                        <span class="spinner-label">ĐẶT HÀNG</span>
                                    </button>
                                    <a href="/GioHang/cart" class="previous-link">
                                        <i class="previous-link__arrow">❮</i>
                                        <span class="previous-link__content">Quay về giỏ hàng</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        }
        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol id="spinner">
                <svg viewBox="0 0 30 30">
                    <circle stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-dasharray="85%" cx="50%" cy="50%" r="40%">
                        <animateTransform attributeName="transform" type="rotate" from="0 15 15" to="360 15 15" dur="0.7s" repeatCount="indefinite"></animateTransform>
                    </circle>
                </svg>
            </symbol>
        </svg>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        function initializeDropdowns(citisId, districtId, wardId, citisValue, districtValue, wardValue) {
            // Lấy đối tượng select box dựa vào class        
            // Lấy tham chiếu đến các phần tử select từ id
            var citis = document.getElementById(citisId);
            var districts = document.getElementById(districtId);
            var wards = document.getElementById(wardId);
            // Tạo đối tượng Parameter chứa thông tin yêu cầu HTTP GET
            var Parameter = {
                url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
                method: "GET",
                responseType: "application/json",
            };

            // Gửi yêu cầu HTTP GET và nhận dữ liệu từ tệp JSON
            var promise = axios(Parameter);
            promise.then(function (result) {
                renderCity(result.data);
            });

            // Hàm renderCity để tạo các tùy chọn cho select tỉnh/thành phố
            function renderCity(data) {
                for (const x of data) {
                    citis.options[citis.options.length] = new Option(x.Name, x.Id = x.Name);
                    if (x.Name == citisValue) {
                        citis.value = citisValue;
                    }
                }
                // Xử lý khi select tỉnh/thành phố thay đổi
                citis.onchange = function () {
                    districts.length = 1;
                    wards.length = 1;
                    // Lọc dữ liệu quận/huyện dựa trên tỉnh/thành phố được chọn
                    const result = data.filter(n => n.Id === this.value);

                    // Tạo các tùy chọn cho select quận/huyện
                    for (const k of result[0].Districts) {
                        districts.options[districts.options.length] = new Option(k.Name, k.Id = k.Name);
                        if (k.Name == districtValue) {
                            districts.value = districtValue;
                        }
                    }

                    districts.disabled = false;
                    wards.disabled = true;
                    wards.innerHTML = '<option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>';
                };

                // Xử lý khi select quận/huyện thay đổi
                districts.onchange = function () {
                    const selectedDistrict = this.value;
                    if (selectedDistrict !== '') {
                        wards.length = 1;
                        const dataCity = data.filter(n => n.Id === citis.value);
                        const dataWards = dataCity[0].Districts.filter(n => n.Id === selectedDistrict)[0].Wards;
                        // Tạo các tùy chọn cho select phường/xã
                        for (const w of dataWards) {
                            wards.options[wards.options.length] = new Option(w.Name, w.Id = w.Name);
                            if (w.Name == wardValue) {
                                wards.value = wardValue;
                            }
                        }
                        wards.disabled = false;
                    } else {
                        wards.disabled = true;
                        wards.innerHTML = '<option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>';
                    }
                };
                // Kiểm tra nếu select tỉnh/thành phố đã có giá trị được chọn sẵn
                if (citis.value !== null && citis.value !== '') {
                    districts.disabled = false;
                    const changeEvent = new Event('change');
                    citis.dispatchEvent(changeEvent);
                    const selectedDistrict = districts.value;

                    if (selectedDistrict.value !== null && selectedDistrict.value !== '') {
                        wards.disabled = false;
                        // Gọi sự kiện onchange của quận/huyện để kích hoạt xử lý
                        const changeEvent = new Event('change');
                        districts.dispatchEvent(changeEvent);
                    }
                }
                // Xử lý sự kiện khi select tỉnh/thành phố thay đổi
                citis.addEventListener('change', function () {
                    var selectedProvince = this.value;
                    if (selectedProvince !== "") {
                        districts.disabled = false;
                    } else {
                        districts.disabled = true;
                        districts.innerHTML = '<option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>';
                        wards.disabled = true;
                        wards.innerHTML = '<option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>';
                    }
                });

                // Xử lý sự kiện khi select quận/huyện thay đổi
                districts.addEventListener('change', function () {
                    var selectedDistrict = this.value;
                    if (selectedDistrict !== "") {
                        wards.disabled = false;
                    } else {
                        wards.disabled = true;
                        wards.innerHTML = '<option value="" hidden="" data-select2-id="select2-data-220-2y2x">---</option>';
                    }
                });
            }
        }
        initializeDropdowns("billingProvince", "billingDistrict", "billingWard");
    </script>

</body>
</html>
